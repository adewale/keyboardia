.step-sequencer {
  background: var(--color-surface);
  border-radius: 12px;
  padding: 24px;
  width: 100%;
  max-width: calc(100vw - 48px); /* Account for app padding */
  position: relative;
  box-sizing: border-box;
}

/* Phase 31A: Progress bar above grid */
.progress-bar-container {
  height: 3px;
  width: 100%;
  background: var(--color-surface-elevated);
  border-radius: 2px;
  margin-bottom: 12px;
  overflow: hidden;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.progress-bar-container.visible {
  opacity: 1;
}

.progress-bar-fill {
  height: 100%;
  width: var(--progress-position, 0%);
  background: var(--color-text-muted);
  border-radius: 2px;
  /* Phase 31A: Smooth easing as per spec - cubic-bezier(0.4, 0, 0.2, 1) */
  transition: width 0.05s cubic-bezier(0.4, 0, 0.2, 1);
  opacity: 0.6;
  /* Removed glow for subtler appearance */
}

/* Respect prefers-reduced-motion */
@media (prefers-reduced-motion: reduce) {
  .progress-bar-fill {
    transition: none;
  }
}

/* Phase 31H: Pitch Panel container - uses grid animation like Mixer for smooth expand/collapse */
.pitch-panel-container {
  display: grid;
  grid-template-rows: 0fr;
  transition: grid-template-rows 0.25s ease-out;
  overflow: hidden;
}

.pitch-panel-container.expanded {
  grid-template-rows: 1fr;
}

.pitch-panel-content {
  min-height: 0;
  overflow: hidden;
  padding: 8px 0 16px;
}

/* Hide on mobile - too cramped */
@media (max-width: 768px) {
  .pitch-panel-container {
    display: none;
  }
}

/* Phase 29E: Content area with tracks and scale sidebar */
.sequencer-content {
  display: flex;
  gap: 0;
}

.tracks {
  flex: 1;
  min-width: 0; /* Allow shrinking */
  /* Horizontal scroll for the "sea of cells" - all tracks scroll together */
  overflow-x: auto;
  padding-bottom: 8px;
}

/* Inner container that expands to fit widest track */
.tracks-inner {
  display: inline-flex;
  flex-direction: column;
  gap: 2px;
  min-width: 100%; /* At least fill the viewport */
  /* Phase 34: Reserve space for 4 tracks to prevent CLS during loading */
  /* 4 tracks * 44px + 3 gaps * 2px = 182px */
  min-height: 182px;
}

@media (max-width: 768px) {
  .tracks-inner {
    /* Mobile: 4 tracks * 48px + 3 gaps * 2px = 198px */
    min-height: 198px;
  }
}

/* Custom scrollbar styling for the tracks panel */
.tracks::-webkit-scrollbar {
  height: 8px;
}

.tracks::-webkit-scrollbar-track {
  background: var(--color-surface-elevated);
  border-radius: 4px;
}

.tracks::-webkit-scrollbar-thumb {
  background: var(--color-surface-active);
  border-radius: 4px;
}

.tracks::-webkit-scrollbar-thumb:hover {
  background: var(--color-border-hover);
}

/* Phase 21: Published session styling - "museum glass" treatment
 * Goals:
 * - User can see the playhead move unobstructed
 * - Clear visual indicator that it's read-only (subtle scrim)
 * - Transport still works for play/pause
 */
.step-sequencer.published {
  /* Subtle border glow to indicate special state */
  box-shadow:
    inset 0 0 0 1px var(--color-purple-muted),
    0 0 20px rgba(155, 89, 182, 0.1);
}

.step-sequencer.published .sequencer-content {
  pointer-events: none;
}

.step-sequencer.published .tracks {
  position: relative;
}

/* Glass/scrim overlay effect - subtle, doesn't block visibility */
.step-sequencer.published .tracks::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    135deg,
    rgba(155, 89, 182, 0.03) 0%,
    rgba(155, 89, 182, 0.06) 50%,
    rgba(155, 89, 182, 0.03) 100%
  );
  pointer-events: none;
  z-index: 10;
  border-radius: 4px;
}

/* Subtle scan-line effect for "frozen in time" feel */
.step-sequencer.published .tracks::after {
  content: '';
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(155, 89, 182, 0.02) 2px,
    rgba(155, 89, 182, 0.02) 4px
  );
  pointer-events: none;
  z-index: 11;
  border-radius: 4px;
}

/* Slightly desaturate track controls but keep playhead visible */
.step-sequencer.published .track-row {
  filter: saturate(0.85);
}

/* Keep the playhead vibrant */
.step-sequencer.published .step-cell.playing::before {
  filter: saturate(1.3);
}

.step-sequencer.published .transport {
  pointer-events: auto; /* Allow play/pause */
}

/* Disable tempo and swing controls - only play button should work */
.step-sequencer.published .transport .tempo-control,
.step-sequencer.published .transport .swing-control {
  pointer-events: none;
  opacity: 0.5;
  cursor: default;
}

/* Ensure sliders don't show pointer cursor */
.step-sequencer.published .transport .tempo-control input,
.step-sequencer.published .transport .swing-control input {
  cursor: default;
}

/* Mobile TransportBar - disable tempo/swing drag controls */
.step-sequencer.published .transport-bar .transport-value {
  pointer-events: none;
  opacity: 0.5;
  cursor: default;
}

/* Hide the drag hint arrow on disabled controls */
.step-sequencer.published .transport-bar .transport-value::after {
  display: none;
}

/* Phase 31F: Selection badge */
.selection-badge {
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: var(--color-info);
  color: white;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 500;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  z-index: 100;
  animation: slide-up 0.15s ease-out;
}

@keyframes slide-up {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

.selection-badge .selection-count {
  font-weight: 700;
  font-size: 14px;
}

.selection-badge .selection-label {
  opacity: 0.9;
}

.selection-badge .selection-clear {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: white;
  font-size: 14px;
  line-height: 1;
  margin-left: 4px;
  padding: 0;
  transition: background 0.15s ease;
}

.selection-badge .selection-clear:hover {
  background: rgba(255, 255, 255, 0.35);
}

/* Reduce motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {
  .selection-badge {
    animation: none;
  }
}

